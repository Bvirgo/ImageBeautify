environment:
  matrix:
    - QTDIR: C:\Qt\5.10\msvc2017_64

configuration:
  - release

# Get the project submodules
# Set the environment variables and paths to make
install:
  - git submodule update --init --recursive
  - set PATH=%PATH%;%QTDIR%\bin;%APPVEYOR_BUILD_FOLDER%\OpenCV\win32\bin
  - if %QTDIR:msvc2015=%==%QTDIR% call "%ProgramFiles(x86)%\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" %ARCH%
  - if %QTDIR:msvc2017=%==%QTDIR% call "%ProgramFiles(x86)%\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvarsall.bat" %ARCH%
  - if %QTDIR:msvc=%==%QTDIR% set make=nmake.exe
  - if %QTDIR:msvc=%==%QTDIR% %make% /? > nul

# Run qmake
before_build:
  - cd %APPVEYOR_BUILD_FOLDER%
  - mkdir build
  - cd build
  - qmake ..\temp\imageBeautify.pro


# Build the projects
build_script:
  - cd %APPVEYOR_BUILD_FOLDER%
  - cd build
  - '%make%'
  
  
after_build:
  - cd %APPVEYOR_BUILD_FOLDER%\build\release
  - mkdir release
  - cd release
  - xcopy %APPVEYOR_BUILD_FOLDER%\build\release\imageBeautify.exe %APPVEYOR_BUILD_FOLDER%\build\release\release\
  - windeployqt imageBeautify.exe
  

artifacts:
  - path: build\release\release\
    name: image_beautify_bin
  - path: temp\
    name: image_beautify_src

deploy:
  - provider: GitHub
    auth_token:
      secure: 0ITmy8HuewW3zTSS4Zfusi9wn6G2Hmq718SLrQNDiDFC89ZcrBrYSyE1gWQJ9Om2
    prerelease: true
